# ğŸš€ BCal SAAS Netlify Deployment Guide

This guide walks you through deploying BCal SAAS with the frontend on Netlify and backend services on Railway/Heroku.

## ğŸ—ï¸ **Architecture Overview**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚    â”‚   Backend API   â”‚    â”‚ Licensing Serverâ”‚
â”‚   (Netlify)     â”‚â—„â”€â”€â–ºâ”‚   (Railway)     â”‚â—„â”€â”€â–ºâ”‚   (Railway)     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ React App     â”‚    â”‚ â€¢ FastAPI       â”‚    â”‚ â€¢ License API   â”‚
â”‚ â€¢ Static Files  â”‚    â”‚ â€¢ PostgreSQL    â”‚    â”‚ â€¢ PostgreSQL    â”‚
â”‚ â€¢ CDN           â”‚    â”‚ â€¢ Redis         â”‚    â”‚ â€¢ Usage Trackingâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ **Prerequisites**

- âœ… Node.js 16+ installed
- âœ… Git repository (GitHub recommended)
- âœ… Netlify account (free tier available)
- âœ… Railway account (for backend) - OR - Heroku account
- âœ… Stripe account (for billing)
- âœ… Email service (Gmail/SMTP)

## ğŸ¯ **Step 1: Prepare Your Repository**

### 1.1 Push to GitHub
```bash
# Initialize git if not already done
git init
git add .
git commit -m "Initial BCal SAAS commit"

# Push to GitHub
git remote add origin https://github.com/yourusername/bcal-saas.git
git push -u origin main
```

### 1.2 Environment Setup
Copy the environment template:
```bash
cp env.saas.example .env.netlify
```

Edit `.env.netlify` with your settings (we'll use these later).

## ğŸŒ **Step 2: Deploy Frontend to Netlify**

### 2.1 Automatic Deployment (Recommended)

1. **Go to Netlify Dashboard**
   - Visit [netlify.com](https://netlify.com)
   - Sign up/login with GitHub

2. **Create New Site**
   - Click "New site from Git"
   - Choose "GitHub" 
   - Select your BCal repository

3. **Configure Build Settings**
   ```
   Build command: cd frontend && npm ci && npm run build
   Publish directory: frontend/build
   ```

4. **Set Environment Variables**
   Go to Site settings â†’ Environment variables and add:
   ```bash
   REACT_APP_API_URL=https://your-backend.railway.app/api
   REACT_APP_STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_key
   REACT_APP_ENABLE_MULTI_TENANCY=true
   NODE_VERSION=18
   ```
   
   âš ï¸ **Note**: You'll get the backend URL after deploying to Railway in Step 3.

5. **Deploy**
   - Click "Deploy site"
   - Netlify will automatically build and deploy
   - You'll get a URL like `https://amazing-app-123456.netlify.app`

### 2.2 Manual Deployment (Alternative)

Use our deployment script:
```bash
# Set your backend URL (update after deploying backend)
export REACT_APP_API_URL="https://your-backend-url.railway.app/api"
export REACT_APP_STRIPE_PUBLISHABLE_KEY="pk_test_your_stripe_key"

# Run deployment script
./deploy-netlify.sh
```

## ğŸ”§ **Step 3: Deploy Backend to Railway**

### 3.1 Install Railway CLI
```bash
npm install -g @railway/cli
```

### 3.2 Login to Railway
```bash
railway login
```

### 3.3 Create Railway Project
```bash
# Create new project
railway init

# Or link to existing project
railway link [project-id]
```

### 3.4 Add Database Services
```bash
# Add PostgreSQL for main app
railway add postgresql

# Add Redis for caching
railway add redis
```

### 3.5 Deploy Main Backend
```bash
# In the backend directory
cd backend
railway up
```

### 3.6 Set Environment Variables
In Railway dashboard, add these environment variables:

```bash
# Database (auto-generated by Railway)
DATABASE_URL=${{Postgres.DATABASE_URL}}
REDIS_URL=${{Redis.REDIS_URL}}

# Security
SECRET_KEY=your-super-secret-jwt-key-change-this
LICENSING_API_KEY=your-licensing-api-key-change-this

# Multi-tenancy
ENABLE_MULTI_TENANCY=true
TRIAL_DAYS=14

# Stripe Billing
STRIPE_ENABLED=true
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# Email
EMAIL_ENABLED=true
EMAIL_HOST=smtp.gmail.com
EMAIL_USERNAME=your-email@gmail.com
EMAIL_PASSWORD=your-gmail-app-password

# CORS (update with your Netlify URL)
ALLOWED_ORIGINS=["https://your-site.netlify.app","https://*.your-domain.com"]

# Licensing Server URL (will be set after next step)
LICENSING_SERVER_URL=https://your-licensing-server.railway.app
```

### 3.7 Deploy Licensing Server
```bash
# Create separate Railway service for licensing
cd ../licensing-server
railway init
railway add postgresql  # Separate database for licensing
railway up
```

Set environment variables for licensing server:
```bash
DATABASE_URL=${{Postgres.DATABASE_URL}}
LICENSE_SERVER_SECRET=your-licensing-secret-key
LICENSING_API_KEY=your-licensing-api-key-change-this
```

## ğŸ”— **Step 4: Connect Frontend to Backend**

### 4.1 Update Netlify Environment Variables
Go back to Netlify dashboard and update:
```bash
REACT_APP_API_URL=https://your-backend.railway.app/api
```

### 4.2 Update Backend CORS
In Railway dashboard, update the backend's `ALLOWED_ORIGINS`:
```bash
ALLOWED_ORIGINS=["https://your-site.netlify.app"]
```

### 4.3 Redeploy Frontend
Netlify will automatically redeploy when you update environment variables.

## ğŸ¨ **Step 5: Configure Custom Domain (Optional)**

### 5.1 Add Domain to Netlify
1. Go to Site settings â†’ Domain management
2. Click "Add custom domain"
3. Enter your domain (e.g., `bcal.yourcompany.com`)

### 5.2 Configure DNS
Add these DNS records:
```
Type: CNAME
Name: bcal (or @)
Value: your-site.netlify.app

Type: CNAME  
Name: *
Value: your-site.netlify.app
```

### 5.3 Enable HTTPS
Netlify automatically provides SSL certificates via Let's Encrypt.

## ğŸ’³ **Step 6: Set Up Stripe Webhooks**

### 6.1 Configure Webhook Endpoint
In your Stripe dashboard:
1. Go to Developers â†’ Webhooks
2. Add endpoint: `https://your-backend.railway.app/api/webhooks/stripe`
3. Select events:
   - `invoice.payment_succeeded`
   - `invoice.payment_failed`
   - `customer.subscription.updated`
   - `customer.subscription.deleted`

### 6.2 Update Webhook Secret
Copy the webhook secret and update your Railway environment variables:
```bash
STRIPE_WEBHOOK_SECRET=whsec_your_actual_webhook_secret
```

## ğŸ§ª **Step 7: Test Your Deployment**

### 7.1 Frontend Tests
- âœ… Visit your Netlify URL
- âœ… Check if the app loads
- âœ… Test organization signup
- âœ… Verify API calls work

### 7.2 Backend Tests
- âœ… Visit `https://your-backend.railway.app/api/docs`
- âœ… Test API endpoints
- âœ… Check database connections
- âœ… Verify email sending

### 7.3 Full Flow Test
1. Create test organization
2. Add test users
3. Create test bookings
4. Test billing flow (with test Stripe cards)

## ğŸ“Š **Step 8: Monitor Your Deployment**

### 8.1 Netlify Monitoring
- Site dashboard shows deployment status
- Analytics for frontend performance
- Function logs (if using Netlify functions)

### 8.2 Railway Monitoring
- Resource usage metrics
- Application logs
- Database performance

### 8.3 Set Up Alerts
Configure alerts for:
- High error rates
- Database connection issues
- Payment failures
- Resource usage spikes

## ğŸ’° **Cost Breakdown**

### Free Tier (Development)
- **Netlify**: Free (100GB bandwidth, 300 build minutes)
- **Railway**: $5/month (trial credit available)
- **Total**: ~$5/month

### Production Tier
- **Netlify Pro**: $19/month (1TB bandwidth, 1000 build minutes)
- **Railway Pro**: $20-50/month (depending on usage)
- **Database**: Included in Railway Pro
- **Total**: ~$40-70/month

## ğŸ”§ **Troubleshooting**

### Common Issues

1. **Frontend not loading**
   - Check build logs in Netlify
   - Verify environment variables
   - Check console for errors

2. **API calls failing**
   - Verify `REACT_APP_API_URL` is correct
   - Check CORS settings in backend
   - Verify backend is running

3. **Database connection errors**
   - Check Railway database status
   - Verify connection string
   - Check firewall settings

4. **Stripe webhooks not working**
   - Verify webhook URL is correct
   - Check webhook secret matches
   - Test with Stripe CLI

### Getting Help
- **Netlify**: [Netlify Support](https://www.netlify.com/support/)
- **Railway**: [Railway Discord](https://discord.gg/railway)
- **BCal Issues**: Create issue in your repository

## ğŸš€ **Next Steps**

1. **Set up monitoring**: Add error tracking with Sentry
2. **Configure backups**: Set up database backups
3. **Add analytics**: Google Analytics or Mixpanel
4. **Performance optimization**: CDN, caching, compression
5. **Security hardening**: Rate limiting, security headers
6. **CI/CD pipeline**: Automate deployments with GitHub Actions

## ğŸ‰ **Congratulations!**

Your BCal SAAS platform is now live with:
- âœ… Frontend hosted on Netlify with global CDN
- âœ… Backend services on Railway with auto-scaling
- âœ… Multi-tenant architecture with custom domains
- âœ… Stripe billing integration
- âœ… White labeling capabilities
- âœ… License management system

Your users can now:
- Sign up for organizations at your Netlify URL
- Get 14-day free trials
- Pay $2.99/user/month automatically
- Use custom domains and branding
- Scale their usage as needed

**Your SAAS platform is ready for customers! ğŸ¯**
